# 更新说明

## 最新功能（v1.1）

### 1. 智能资金管理 💰

**新增配置参数：**
- `position_size_percent`: 资金百分比（默认 5%）

**功能说明：**
- 自动使用账户资金的指定百分比开仓
- 无需手动计算每个币种的下单数量
- 账户资金变化时，仓位大小自动调整

**配置示例：**
```json
{
  "default_quantity": 0,
  "position_size_percent": 5.0
}
```

**日志示例：**
```
💰 自动计算数量: 0.01234567 (账户资金的 5.0%)
📊 账户净值: 1000.00 USDT
📊 下单金额: 50.00 USDT (5.0%)
📊 当前价格: 45000.00 USDT
📊 计算数量: 0.00111111
```

### 2. 仓位保护机制 🛡️

**功能说明：**
- 开仓前自动检查该币种是否已有仓位
- 如果已有仓位（多仓或空仓），自动跳过开仓信号
- 避免重复开仓和意外对冲

**日志示例：**
```
⚠️ BTCUSDT 已有 long 仓位，跳过开仓
```

**返回示例：**
```json
{
  "action": "buy",
  "symbol": "BTCUSDT",
  "status": "skipped",
  "reason": "已有long仓位",
  "message": "BTCUSDT 已有 long 仓位，跳过开多仓"
}
```

## 配置迁移指南

### 从旧版本升级

**旧配置：**
```json
{
  "default_quantity": 0.01
}
```

**新配置（推荐）：**
```json
{
  "default_quantity": 0,
  "position_size_percent": 5.0
}
```

### 两种模式对比

| 模式 | 配置 | 优点 | 缺点 |
|------|------|------|------|
| 固定数量 | `default_quantity: 0.01` | 简单直接 | 不随账户资金变化 |
| 资金百分比 | `position_size_percent: 5.0` | 自动调整，风险可控 | 需要实时查询账户 |

### 推荐配置

**保守型（3%）：**
```json
{
  "default_quantity": 0,
  "position_size_percent": 3.0,
  "default_leverage": 3
}
```

**平衡型（5%）：**
```json
{
  "default_quantity": 0,
  "position_size_percent": 5.0,
  "default_leverage": 5
}
```

**激进型（10%）：**
```json
{
  "default_quantity": 0,
  "position_size_percent": 10.0,
  "default_leverage": 10
}
```

## 使用建议

### 1. 资金管理

- 建议使用 3-5% 的资金百分比
- 避免单次开仓超过 10%
- 考虑同时持仓的币种数量

### 2. 仓位控制

- 利用仓位保护机制，避免重复开仓
- 需要反向开仓时，先发送平仓信号
- 定期检查持仓情况

### 3. 风险控制

- 设置合理的杠杆倍数（建议 3-5x）
- 使用止损止盈策略
- 监控账户净值变化

## 常见问题

### Q1: 为什么我的信号被跳过了？

**A:** 系统检测到该币种已有仓位。这是保护机制，避免重复开仓。

**解决方法：**
1. 检查当前持仓
2. 如需反向开仓，先发送平仓信号
3. 等待平仓完成后再发送新的开仓信号

### Q2: 资金百分比模式下，数量是如何计算的？

**A:** 计算公式：
```
下单金额 = 账户净值 × 资金百分比
下单数量 = 下单金额 ÷ 当前价格
```

**示例：**
- 账户净值：1000 USDT
- 资金百分比：5%
- BTC 价格：50000 USDT
- 下单金额：1000 × 5% = 50 USDT
- 下单数量：50 ÷ 50000 = 0.001 BTC

### Q3: 可以同时使用固定数量和资金百分比吗？

**A:** 不可以。系统优先使用固定数量：
- 如果 `default_quantity > 0`，使用固定数量
- 如果 `default_quantity = 0`，使用资金百分比

### Q4: 仓位保护会影响平仓吗？

**A:** 不会。仓位保护只在开仓时生效，平仓操作不受影响。

## 更新日志

### v1.1 (2024-12-06)
- ✨ 新增：资金百分比模式
- ✨ 新增：仓位保护机制
- 📝 更新：配置文件示例
- 📝 更新：文档和使用指南

### v1.0 (2024-12-05)
- 🎉 初始版本发布
- ✅ 支持 TradingView Webhook
- ✅ 支持 Hyperliquid 交易所
- ✅ 支持做多、做空、平仓操作
