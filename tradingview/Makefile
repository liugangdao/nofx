.PHONY: build run test clean help

# é»˜è®¤ç›®æ ‡
help:
	@echo "TradingView Webhook æ„å»ºå·¥å…·"
	@echo ""
	@echo "å¯ç”¨å‘½ä»¤:"
	@echo "  make build   - ç¼–è¯‘ç¨‹åº"
	@echo "  make run     - è¿è¡Œç¨‹åº"
	@echo "  make test    - è¿è¡Œæµ‹è¯•"
	@echo "  make clean   - æ¸…ç†ç¼–è¯‘æ–‡ä»¶"
	@echo "  make install - å®‰è£…ä¾èµ–"

# ç¼–è¯‘
build:
	@echo "ğŸ”¨ ç¼–è¯‘ TradingView Webhook..."
	go build -o tradingview_webhook main.go
	@echo "âœ… ç¼–è¯‘å®Œæˆï¼"

# è¿è¡Œ
run:
	@echo "ğŸš€ å¯åŠ¨ TradingView Webhook..."
	go run main.go -config tradingview_config.json

# æµ‹è¯•
test:
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	@if [ -f test_webhook.sh ]; then \
		bash test_webhook.sh; \
	else \
		echo "âŒ æµ‹è¯•è„šæœ¬ä¸å­˜åœ¨"; \
	fi

# æ¸…ç†
clean:
	@echo "ğŸ§¹ æ¸…ç†ç¼–è¯‘æ–‡ä»¶..."
	rm -f tradingview_webhook
	@echo "âœ… æ¸…ç†å®Œæˆï¼"

# å®‰è£…ä¾èµ–
install:
	@echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
	go mod tidy
	@echo "âœ… ä¾èµ–å®‰è£…å®Œæˆï¼"

# ç¼–è¯‘ Windows ç‰ˆæœ¬
build-windows:
	@echo "ğŸ”¨ ç¼–è¯‘ Windows ç‰ˆæœ¬..."
	GOOS=windows GOARCH=amd64 go build -o tradingview_webhook.exe main.go
	@echo "âœ… Windows ç‰ˆæœ¬ç¼–è¯‘å®Œæˆï¼"

# ç¼–è¯‘ Linux ç‰ˆæœ¬
build-linux:
	@echo "ğŸ”¨ ç¼–è¯‘ Linux ç‰ˆæœ¬..."
	GOOS=linux GOARCH=amd64 go build -o tradingview_webhook_linux main.go
	@echo "âœ… Linux ç‰ˆæœ¬ç¼–è¯‘å®Œæˆï¼"

# ç¼–è¯‘æ‰€æœ‰å¹³å°
build-all: build-windows build-linux
	@echo "âœ… æ‰€æœ‰å¹³å°ç¼–è¯‘å®Œæˆï¼"

# å¯åŠ¨æœåŠ¡ï¼ˆåå°ï¼‰
start:
	@echo "ğŸš€ å¯åŠ¨æœåŠ¡..."
	@chmod +x start.sh
	@./start.sh

# åœæ­¢æœåŠ¡
stop:
	@echo "ğŸ›‘ åœæ­¢æœåŠ¡..."
	@chmod +x stop.sh
	@./stop.sh

# é‡å¯æœåŠ¡
restart:
	@echo "ğŸ”„ é‡å¯æœåŠ¡..."
	@chmod +x restart.sh
	@./restart.sh

# æŸ¥çœ‹çŠ¶æ€
status:
	@chmod +x status.sh
	@./status.sh

# æŸ¥çœ‹æ—¥å¿—
logs:
	@chmod +x logs.sh
	@./logs.sh -f

# æ·»åŠ æ‰§è¡Œæƒé™
chmod:
	@echo "ğŸ“ æ·»åŠ æ‰§è¡Œæƒé™..."
	@chmod +x start.sh stop.sh restart.sh status.sh logs.sh test_curl.sh
	@echo "âœ… æƒé™è®¾ç½®å®Œæˆï¼"
