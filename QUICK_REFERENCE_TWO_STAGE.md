# ä¸¤é˜¶æ®µæ­¢ç›ˆç­–ç•¥ - å¿«é€Ÿå‚è€ƒ

## ðŸŽ¯ æ ¸å¿ƒæ¦‚å¿µ

```
å…¥åœº â†’ ç¬¬ä¸€é˜¶æ®µ(2R) â†’ ç¬¬äºŒé˜¶æ®µ(ç§»åŠ¨æ­¢ç›ˆ) â†’ ç¦»åœº
       â†“                â†“
    50%æ­¢ç›ˆ          è¶…çº§è¶‹åŠ¿
    æ­¢æŸä¿æœ¬          åŠ¨æ€æ­¢æŸ
```

## ðŸ“Š ç¬¬ä¸€é˜¶æ®µï¼šå›ºå®šç›®æ ‡ (2R)

| åŠ¨ä½œ | æ“ä½œ | ç›®çš„ |
|------|------|------|
| éƒ¨åˆ†æ­¢ç›ˆ | `decrease_long/short` 50% | é”å®šåˆ©æ¶¦ |
| ç§»åŠ¨æ­¢æŸ | `update_loss_profit` è‡³å…¥åœºä»· | ä¿æœ¬ |
| çŠ¶æ€æ›´æ–° | Stage: 1 â†’ 2 | è¿›å…¥ç¬¬äºŒé˜¶æ®µ |

**è§¦å‘æ¡ä»¶**: æµ®ç›ˆ â‰¥ 2R (2å€åˆå§‹æ­¢æŸè·ç¦»)

## ðŸš€ ç¬¬äºŒé˜¶æ®µï¼šç§»åŠ¨æ­¢ç›ˆ

### å¤šå¤´ä»“ä½
```
æ­¢æŸ = è¶…çº§è¶‹åŠ¿æ”¯æ’‘ä½ (Supertrend.SupportLevel)
ä»·æ ¼ä¸Šæ¶¨ â†’ æ”¯æ’‘ä½ä¸Šç§» â†’ æ­¢æŸä¸Šç§»
ä»·æ ¼è·Œç ´æ”¯æ’‘ â†’ å¹³ä»“ç¦»åœº
```

### ç©ºå¤´ä»“ä½
```
æ­¢æŸ = è¶…çº§è¶‹åŠ¿é˜»åŠ›ä½ (Supertrend.ResistanceLevel)
ä»·æ ¼ä¸‹è·Œ â†’ é˜»åŠ›ä½ä¸‹ç§» â†’ æ­¢æŸä¸‹ç§»
ä»·æ ¼çªç ´é˜»åŠ› â†’ å¹³ä»“ç¦»åœº
```

## ðŸ“ˆ è¶…çº§è¶‹åŠ¿æŒ‡æ ‡

### å‚æ•°
- **ATR å‘¨æœŸ**: 10
- **ATR å€æ•°**: 3.0

### è¶‹åŠ¿åˆ¤æ–­
```
UPTREND   â†’ ä½¿ç”¨ä¸‹è½¨ä½œä¸ºæ”¯æ’‘
DOWNTREND â†’ ä½¿ç”¨ä¸Šè½¨ä½œä¸ºé˜»åŠ›
```

### æ˜¾ç¤ºä½ç½®
```
**è¶…çº§è¶‹åŠ¿(4h)**: UPTREND | æ”¯æ’‘98000 | é˜»åŠ›102000
**è¶…çº§è¶‹åŠ¿(15m)**: UPTREND | æ”¯æ’‘97500 | é˜»åŠ›101500
```

## ðŸ’¡ AI å†³ç­–æ¨¡æ¿

### æ¨¡æ¿ 1: è¾¾åˆ° 2Rï¼Œè¿›å…¥ç¬¬ä¸€é˜¶æ®µ
```json
[
  {
    "symbol": "BTCUSDT",
    "action": "decrease_long",
    "position_size_usd": 500,
    "reasoning": "æµ®ç›ˆè¾¾åˆ°2R(+20%)ï¼Œéƒ¨åˆ†æ­¢ç›ˆ50%"
  },
  {
    "symbol": "BTCUSDT",
    "action": "update_loss_profit",
    "stop_loss": 95000,
    "take_profit": 110000,
    "reasoning": "ç§»åŠ¨æ­¢æŸè‡³å…¥åœºä»·ï¼Œè¿›å…¥ç¬¬äºŒé˜¶æ®µ"
  }
]
```

### æ¨¡æ¿ 2: ç¬¬äºŒé˜¶æ®µç§»åŠ¨æ­¢æŸ
```json
[
  {
    "symbol": "BTCUSDT",
    "action": "update_loss_profit",
    "stop_loss": 98000,
    "take_profit": 115000,
    "reasoning": "æ ¹æ®è¶…çº§è¶‹åŠ¿æ”¯æ’‘ä½ç§»åŠ¨æ­¢æŸ"
  }
]
```

### æ¨¡æ¿ 3: è¶…çº§è¶‹åŠ¿åè½¬ï¼Œå¹³ä»“
```json
[
  {
    "symbol": "BTCUSDT",
    "action": "close_long",
    "reasoning": "ä»·æ ¼è·Œç ´è¶…çº§è¶‹åŠ¿æ”¯æ’‘ï¼Œè¶‹åŠ¿åè½¬"
  }
]
```

## ðŸ” å…³é”®å­—æ®µ

### PnLTracking
```go
Stage             int     // 1=ç¬¬ä¸€é˜¶æ®µ, 2=ç¬¬äºŒé˜¶æ®µ
PartialTakenAt    float64 // éƒ¨åˆ†æ­¢ç›ˆä»·æ ¼
RemainingQuantity float64 // å‰©ä½™ä»“ä½ (0.5 = 50%)
```

### SupertrendData
```go
Trend           string  // "UPTREND" / "DOWNTREND"
SupportLevel    float64 // æ”¯æ’‘ä½
ResistanceLevel float64 // é˜»åŠ›ä½
```

## âš™ï¸ é…ç½®ä½ç½®

### ä¿®æ”¹ ATR å‚æ•°
```go
// market/data.go, line ~750
data.Supertrend = calculateSupertrend(klines, 10, 3.0)
//                                            â†‘    â†‘
//                                         å‘¨æœŸ  å€æ•°
```

### ä¿®æ”¹éƒ¨åˆ†æ­¢ç›ˆæ¯”ä¾‹
```go
// trader/position_manager.go, executeDecreaseLong/Short
if remainingPct >= 0.4 && remainingPct <= 0.6 && tracking.Stage == 1 {
//                 â†‘                    â†‘
//              40%-60% èŒƒå›´åˆ¤æ–­ä¸ºè¿›å…¥ç¬¬äºŒé˜¶æ®µ
```

## ðŸ“ æ—¥å¿—ç¤ºä¾‹

```
ðŸ“Š è¿›å…¥ç¬¬äºŒé˜¶æ®µç§»åŠ¨æ­¢ç›ˆ (å‰©ä½™ä»“ä½: 50%)
**è¶…çº§è¶‹åŠ¿(4h)**: UPTREND | æ”¯æ’‘98000.00 | é˜»åŠ›102000.00
âœ“ BTCUSDT decrease_long æˆåŠŸ
âœ“ BTCUSDT update_loss_profit æˆåŠŸ
```

## ðŸŽ“ æœ€ä½³å®žè·µ

1. **å¤šå‘¨æœŸç¡®è®¤**: åŒæ—¶å‚è€ƒ 4h å’Œ 15m è¶…çº§è¶‹åŠ¿
2. **çµæ´»è°ƒæ•´**: AI å¯æ ¹æ®å¸‚åœºæƒ…å†µè°ƒæ•´æ¯”ä¾‹
3. **é£Žé™©ä¼˜å…ˆ**: ç¬¬ä¸€é˜¶æ®µå¿…é¡»é”å®šåˆ©æ¶¦
4. **è¶‹åŠ¿è·Ÿéš**: ç¬¬äºŒé˜¶æ®µè€å¿ƒæŒæœ‰ï¼Œè®©åˆ©æ¶¦å¥”è·‘
5. **è®¢å•è¯»å–**: ç³»ç»Ÿè‡ªåŠ¨è¯»å–çŽ°æœ‰æ­¢ç›ˆæ­¢æŸè®¢å•

## ðŸš¨ æ³¨æ„äº‹é¡¹

- âš ï¸ éœ‡è¡å¸‚åœºå¯èƒ½äº§ç”Ÿé¢‘ç¹ä¿¡å·
- âš ï¸ è¶…çº§è¶‹åŠ¿æ˜¯æ»žåŽæŒ‡æ ‡ï¼Œä¸èƒ½é¢„æµ‹åè½¬
- âš ï¸ å…³æ³¨å³°å€¼å›žæ’¤ï¼Œå¿…è¦æ—¶æå‰ç¦»åœº
- âš ï¸ ç»“åˆå…¶ä»–æŒ‡æ ‡ï¼ˆRSIã€MACDï¼‰ç»¼åˆåˆ¤æ–­

## ðŸ“š ç›¸å…³æ–‡æ¡£

- [TWO_STAGE_PROFIT_TAKING.md](TWO_STAGE_PROFIT_TAKING.md) - å®Œæ•´æ–‡æ¡£
- [CHANGELOG_TWO_STAGE_PROFIT.md](CHANGELOG_TWO_STAGE_PROFIT.md) - æ›´æ–°æ—¥å¿—
- [FEATURE_READ_EXISTING_ORDERS.md](FEATURE_READ_EXISTING_ORDERS.md) - è¯»å–çŽ°æœ‰è®¢å•åŠŸèƒ½
